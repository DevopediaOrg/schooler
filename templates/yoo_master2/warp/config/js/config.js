/* Copyright (C) YOOtheme GmbH, http://www.gnu.org/licenses/gpl.html GNU/GPL */

(function($,storage){var cancelcompiling;$(function(){var config=$("#config"),modal=new $.UIkit.modal.Modal("#compilemodal",{bgclose:false}),pgbar=modal.element.find(".uk-progress-bar"),filelabel=modal.element.find(".file-name"),errorlist=modal.element.find(".error-list"),customizer=$("[data-customizer]"),selectors=$("[data-style-selector]",config);layouts("#layout",'[data-layout="default"]');menus($("#menus",config));navigation(config);widgets("#widgets");deviceControls("[data-list-devices]");modal.element.find("button").on("click",function(){cancelCompile();modal.hide()});if(isLessCompilingEnabled()){$("[href=#compile]").on("click",function(e){e.preventDefault();pgbar.css("width","0%");errorlist.html("");filelabel.html("");modal.show();setTimeout(function(){System.data().done(function(data){doCompile(data,{progress:onProgress}).done(function(files){onDone(files,data)}).fail(function(){modal.hide()})}).fail(function(e){modal.hide()})},300)})}else{$("[href=#compile]").attr("disabled","disabled").on("click",function(e){e.preventDefault()})}function onDone(files,data){pgbar.css("width","100%");var params={};$.each(data.styles,function(name,less){params[(name!="default"?"/styles/"+name:"/less")+"/style.less"]=less});$.each(files,function(i,file){if(!file.error){params[file.target]=file.css}});filelabel.text("Saving files...");System.saveFiles(params).fail(function(error){errorlist.append('<div class="uk-alert uk-alert-danger">'+error+"</div>")}).done(function(error){if(!errorlist.children().length)modal.hide()})}function onProgress(file,index,percent){var filename=file.target.replace(/^.*[\/\\]/g,"").replace(/css$/g,"less");filelabel.text(file.target);pgbar.css("width",Math.ceil(percent)+"%");if(file.error&&$("[data-file='"+filename+"']").length===0){errorlist.append('<div class="uk-alert uk-alert-danger" data-file="'+filename+'"><strong>'+filename+"</strong><br>"+file.error.message+"</div>")}}if(isLessCompilingEnabled()){var retrieving=false;$("a",customizer).on("click",function(e){e.preventDefault();if(retrieving)return;retrieving=true;System.data().done(function(data){var body=$("body").addClass("cm-open");$.cookie(data.cookie,"1",{expires:1,path:"/"});config.append($("[type*=template]",customizer).mustache());initCustomizer(data,{cancel:function(){body.removeClass("cm-open")},save:function(selected,styles){body.removeClass("cm-open");var current=data.styles,compile={};data.styles={};$.each(styles,function(i,style){if(selected!=style.name&&current[style.name]){data.styles[style.name]=current[style.name];return}var less=[];if(style.fonts){less.push(style.fonts)}$.each(style.variables,function(name,value){less.push(name+": "+value+";")});data.styles[style.name]=compile[style.name]=less.join("\n")});renderSelect(data);pgbar.css("width","0%");errorlist.html("");filelabel.html("");modal.show();doCompile($.extend({},data,{styles:compile}),{progress:onProgress}).done(function(files){onDone(files,data)}).fail(function(){modal.hide()})}})}).fail(function(error){$("a",customizer).after($('<div class="uk-alert uk-alert-danger" />').text(error))}).always(function(){retrieving=false})})}else{$("a",customizer).attr("disabled","disabled").on("click",function(e){e.preventDefault()});config.prepend('<div class="uk-alert uk-alert-danger">Your browser does not support the customizing and LESS compiling features. Please update your browser.</div>')}function renderSelect(data){selectors.each(function(){var $this=$(this),value=$this.val(),styles=[];$.each(data.styles,function(name){if(name!="default"){styles.push(name)}});styles=$.merge(["default"],$.merge(styles,$this.data("style-css")).sort());$this.html($.mustache('{{#styles}}<option value="{{.}}">{{.}}</option>{{/styles}}',{styles:styles}));$this.trigger("update",value)})}selectors.on("update",function(e,value){var $this=$(this);if(!value)value=$this.data("selected");$this.val($this.find('option[value="'+value+'"]').length?value:$this.val())}).trigger("update")});function initCustomizer(data,options){var $customizer=$("#customizer"),$select=$("select[name=style]",$customizer),$copy=$("[href='#copy']",$customizer),$remove=$("[href='#remove']",$customizer).hide(),$iframe=$("#cm-theme-preview",$customizer).css("visibility","hidden"),$spinner=$("i.cm-spinner",$customizer),$error=$(".cm-error",$customizer),$options=options||{},$styles=[],$style,$sidebar=$(".cm-sidebar-content",$customizer),$message=$(".cm-sidebar-message",$customizer).hide();$.each(data.styles,function(name,less){$styles.push({name:name,config:data.config,config_vars:data.config_vars,variables:$.less.getVars(less)})});$customizer.customizer({styles:$styles,updating:function(e,style){$remove.toggle(style.name!="default");$sidebar.hide();$iframe.css("visibility","hidden");$spinner.show()},updated:function(e,style){var url;style.fonts="";$("option[data-url]:selected",$customizer).each(function(){if((url=$(this).data("url"))&&style.fonts.indexOf("'"+url+"'")===-1){style.fonts+="@import '"+url+"';\n"}});renderPreview($style=style)}});$iframe.on("load",function(){if($style){renderPreview($style)}else{$customizer.trigger("update")}});$error.on({show:function(e,error){$error.html($.mustache('<h1 class="uk-h3">LESS {{type}} Error</h1><p>{{message}}</p>',error)).show();$iframe.css("visibility","hidden")},hide:function(){$error.hide();$iframe.css("visibility","visible")}});$message.on({show:function(e,message){$message.html(message).show();$sidebar.css("visibility","hidden")},hide:function(){$message.hide();$sidebar.css("visibility","visible")}});$copy.on("click",function(e){e.preventDefault();var name=prompt("Please enter a style name","");if(name&&!$('option[value="'+name+'"]',$select).length){$styles.push({name:name,config:data.config,config_vars:data.config_vars,variables:$.extend({},$style.variables)})}$customizer.trigger("update",name)});$remove.on("click",function(e){e.preventDefault();var index;$.each($styles,function(i,style){if($select.val()==style.name){index=i}});if(index!==null){$styles.splice(index,1)}$customizer.trigger("update")});$("[href='#save']",$customizer).on("click",function(e){e.preventDefault();$customizer.remove();$.removeCookie(data.cookie,{path:"/"});if($.isFunction($options.save)){$options.save.call(this,$select.val(),$styles)}});$("[href='#reset']",$customizer).on("click",function(e){e.preventDefault();var name=$select.val(),index;$.each($styles,function(i,style){if($select.val()==style.name){index=i}});if(data.styles[name]&&index!==null){$.extend($styles[index],{config:data.config,variables:$.less.getVars(data.styles[name]),groups:""});$customizer.trigger("update",[name,true])}});$("[href='#cancel']",$customizer).on("click",function(e){e.preventDefault();$customizer.remove();$.removeCookie(data.cookie,{path:"/"});if($.isFunction($options.cancel)){$options.cancel.call(this)}});function renderPreview(style){var iframe=$iframe.contents(),first=true,error=false,customizable=false;$.each(data.less,function(i,file){if(error)return;var tag=iframe.find("head [data-file='"+file.target+"']");if(tag.length){$.less.getCSS(file.source,{id:file.target,variables:style.variables,compress:true}).done(function(css){if(first&&style.fonts){css=style.fonts+"\n"+css}if(iframe.find("html").attr("dir")=="rtl"){css=$.rtl.convert2RTL(css)}if(tag.attr("href")){tag.replaceWith($("<style>").attr("data-file",tag.data("file")).text(css))}else{tag.text(css)}}).fail(function(e){$error.trigger("show",e);error=true});first=false,customizable=true}});if(!error){$sidebar.show();$iframe.css("visibility","visible");$spinner.hide();$error.trigger("hide");setTimeout(function(){$iframe[0].contentWindow.postMessage("customizer-update",location.origin)},150)}$message.trigger(!customizable?"show":"hide","The current theme is not customizable.")}}function doCompile(data,options){cancelcompiling=false;var deferred=$.Deferred(),files=[],i=0;$.each(data.styles,function(name,less){$.each(data.less,function(i,file){files.push({target:(name!="default"?"/styles/"+name:"")+file.target,less:file.source+"\n"+less,css:"",error:""})})});if(!files.length){return deferred.resolve(files)}$.less.getCSS(files[i].less,options).always(function callback(value){if($.type(value)=="string"){files[i].css=value}else{files[i].error=value}files[i].css=$.less.rewriteUrls(files[i].css,data.baseurl+files[i].target);if($.isFunction(options.progress)){options.progress.call(this,files[i],i,i/files.length*100)}if(files[++i]&&!cancelcompiling){setTimeout(function(){$.less.getCSS(files[i].less,options).always(callback)},150)}else{deferred[cancelcompiling?"reject":"resolve"](files)}});return deferred.promise()}function cancelCompile(){cancelcompiling=true}function navigation(root){var nav=root.find(".tm-sidebar ul"),main=root.find(".tm-main");nav.on("click","a",function(e){e.preventDefault();main.children().not("p").hide().filter(":eq("+(storage["_index"]=nav.children("li").removeClass("uk-active").index($(this).parent().addClass("uk-active")))+")").show()}).find("li:eq("+(storage["_index"]<main.children().length?storage["_index"]:0)+") a").trigger("click")}function widgets(root){var positionfilter=$("[data-position-filter]",root).on("change",filterWidgets),namefilter=$("[data-widget-filter]",root).on("keyup",$.UIkit.Utils.debounce(filterWidgets,300));function filterWidgets(){var widgetpattern=namefilter.val(),position=positionfilter.val();$("[data-position]",root).each(function(){var tbl=$(this),posname=tbl.data("position"),tblvisible=position===""||position===posname;tbl[tblvisible?"show":"hide"]();if(tblvisible){tbl.find("tr[data-widget-name]").each(function(){var widget=$(this),name=widget.data("widget-name"),visible=widgetpattern===""||name.toLowerCase().indexOf(widgetpattern.toLowerCase())!==-1;widget.toggle(visible)});if(!tbl.find("tbody>tr:visible").length)tbl.hide()}})}var picker=$('<div class="tm-icon-picker"></div>').css({position:"absolute",display:"none"}).appendTo("body"),list=[],icons={"Web Application Icons":["uk-icon-adjust","uk-icon-anchor","uk-icon-archive","uk-icon-arrows","uk-icon-arrows-h","uk-icon-arrows-v","uk-icon-asterisk","uk-icon-ban","uk-icon-bar-chart-o","uk-icon-barcode","uk-icon-bars","uk-icon-beer","uk-icon-bell","uk-icon-bell-o","uk-icon-bolt","uk-icon-book","uk-icon-bookmark","uk-icon-bookmark-o","uk-icon-briefcase","uk-icon-bug","uk-icon-building-o","uk-icon-bullhorn","uk-icon-bullseye","uk-icon-calendar","uk-icon-calendar-o","uk-icon-camera","uk-icon-camera-retro","uk-icon-caret-square-o-down","uk-icon-caret-square-o-left","uk-icon-caret-square-o-right","uk-icon-caret-square-o-up","uk-icon-certificate","uk-icon-check","uk-icon-check-circle","uk-icon-check-circle-o","uk-icon-check-square","uk-icon-check-square-o","uk-icon-circle","uk-icon-circle-o","uk-icon-clock-o","uk-icon-cloud","uk-icon-cloud-download","uk-icon-cloud-upload","uk-icon-code","uk-icon-code-fork","uk-icon-coffee","uk-icon-cog","uk-icon-cogs","uk-icon-comment","uk-icon-comment-o","uk-icon-comments","uk-icon-comments-o","uk-icon-compass","uk-icon-credit-card","uk-icon-crop","uk-icon-crosshairs","uk-icon-cutlery","uk-icon-dashboard","uk-icon-desktop","uk-icon-dot-circle-o","uk-icon-download","uk-icon-edit","uk-icon-ellipsis-h","uk-icon-ellipsis-v","uk-icon-envelope","uk-icon-envelope-o","uk-icon-eraser","uk-icon-exchange","uk-icon-exclamation","uk-icon-exclamation-circle","uk-icon-exclamation-triangle","uk-icon-external-link","uk-icon-external-link-square","uk-icon-eye","uk-icon-eye-slash","uk-icon-female","uk-icon-fighter-jet","uk-icon-film","uk-icon-filter","uk-icon-fire","uk-icon-fire-extinguisher","uk-icon-flag","uk-icon-flag-checkered","uk-icon-flag-o","uk-icon-flash","uk-icon-flask","uk-icon-folder","uk-icon-folder-o","uk-icon-folder-open","uk-icon-folder-open-o","uk-icon-frown-o","uk-icon-gamepad","uk-icon-gavel","uk-icon-gear","uk-icon-gears","uk-icon-gift","uk-icon-glass","uk-icon-globe","uk-icon-group","uk-icon-hdd-o","uk-icon-headphones","uk-icon-heart","uk-icon-heart-o","uk-icon-home","uk-icon-inbox","uk-icon-info","uk-icon-info-circle","uk-icon-key","uk-icon-keyboard-o","uk-icon-laptop","uk-icon-leaf","uk-icon-legal","uk-icon-lemon-o","uk-icon-level-down","uk-icon-level-up","uk-icon-lightbulb-o","uk-icon-location-arrow","uk-icon-lock","uk-icon-magic","uk-icon-magnet","uk-icon-mail-forward","uk-icon-mail-reply","uk-icon-mail-reply-all","uk-icon-male","uk-icon-map-marker","uk-icon-meh-o","uk-icon-microphone","uk-icon-microphone-slash","uk-icon-minus","uk-icon-minus-circle","uk-icon-minus-square","uk-icon-minus-square-o","uk-icon-mobile","uk-icon-mobile-phone","uk-icon-money","uk-icon-moon-o","uk-icon-music","uk-icon-pencil","uk-icon-pencil-square","uk-icon-pencil-square-o","uk-icon-phone","uk-icon-phone-square","uk-icon-picture-o","uk-icon-plane","uk-icon-plus","uk-icon-plus-circle","uk-icon-plus-square","uk-icon-plus-square-o","uk-icon-power-off","uk-icon-print","uk-icon-puzzle-piece","uk-icon-qrcode","uk-icon-question","uk-icon-question-circle","uk-icon-quote-left","uk-icon-quote-right","uk-icon-random","uk-icon-refresh","uk-icon-reply","uk-icon-reply-all","uk-icon-retweet","uk-icon-road","uk-icon-rocket","uk-icon-rss","uk-icon-rss-square","uk-icon-search","uk-icon-search-minus","uk-icon-search-plus","uk-icon-share","uk-icon-share-square","uk-icon-share-square-o","uk-icon-shield","uk-icon-shopping-cart","uk-icon-sign-in","uk-icon-sign-out","uk-icon-signal","uk-icon-sitemap","uk-icon-smile-o","uk-icon-sort","uk-icon-sort-alpha-asc","uk-icon-sort-alpha-desc","uk-icon-sort-amount-asc","uk-icon-sort-amount-desc","uk-icon-sort-asc","uk-icon-sort-desc","uk-icon-sort-down","uk-icon-sort-numeric-asc","uk-icon-sort-numeric-desc","uk-icon-sort-up","uk-icon-spinner","uk-icon-square","uk-icon-square-o","uk-icon-star","uk-icon-star-half","uk-icon-star-half-empty","uk-icon-star-half-full","uk-icon-star-half-o","uk-icon-star-o","uk-icon-subscript","uk-icon-suitcase","uk-icon-sun-o","uk-icon-superscript","uk-icon-tablet","uk-icon-tachometer","uk-icon-tag","uk-icon-tags","uk-icon-tasks","uk-icon-terminal","uk-icon-thumb-tack","uk-icon-thumbs-down","uk-icon-thumbs-o-down","uk-icon-thumbs-o-up","uk-icon-thumbs-up","uk-icon-ticket","uk-icon-times","uk-icon-times-circle","uk-icon-times-circle-o","uk-icon-tint","uk-icon-toggle-down","uk-icon-toggle-left","uk-icon-toggle-right","uk-icon-toggle-up","uk-icon-trash-o","uk-icon-trophy","uk-icon-truck","uk-icon-umbrella","uk-icon-unlock","uk-icon-unlock-alt","uk-icon-unsorted","uk-icon-upload","uk-icon-user","uk-icon-users","uk-icon-video-camera","uk-icon-volume-down","uk-icon-volume-off","uk-icon-volume-up","uk-icon-warning","uk-icon-wheelchair","uk-icon-wrench"],"Currency Icons":["uk-icon-bitcoin","uk-icon-btc","uk-icon-cny","uk-icon-dollar","uk-icon-eur","uk-icon-euro","uk-icon-gbp","uk-icon-inr","uk-icon-jpy","uk-icon-krw","uk-icon-money","uk-icon-rmb","uk-icon-rouble","uk-icon-rub","uk-icon-ruble","uk-icon-rupee","uk-icon-try","uk-icon-turkish-lira","uk-icon-usd","uk-icon-won","uk-icon-yen"],"Text Editor Icons":["uk-icon-align-center","uk-icon-align-justify","uk-icon-align-left","uk-icon-align-right","uk-icon-bold","uk-icon-chain","uk-icon-chain-broken","uk-icon-clipboard","uk-icon-columns","uk-icon-copy","uk-icon-cut","uk-icon-dedent","uk-icon-eraser","uk-icon-file","uk-icon-file-o","uk-icon-file-text","uk-icon-file-text-o","uk-icon-files-o","uk-icon-floppy-o","uk-icon-font","uk-icon-indent","uk-icon-italic","uk-icon-link","uk-icon-list","uk-icon-list-alt","uk-icon-list-ol","uk-icon-list-ul","uk-icon-outdent","uk-icon-paperclip","uk-icon-paste","uk-icon-repeat","uk-icon-rotate-left","uk-icon-rotate-right","uk-icon-save","uk-icon-scissors","uk-icon-strikethrough","uk-icon-table","uk-icon-text-height","uk-icon-text-width","uk-icon-th","uk-icon-th-large","uk-icon-th-list","uk-icon-underline","uk-icon-undo","uk-icon-unlink"],"Directional Icons":["uk-icon-angle-double-down","uk-icon-angle-double-left","uk-icon-angle-double-right","uk-icon-angle-double-up","uk-icon-angle-down","uk-icon-angle-left","uk-icon-angle-right","uk-icon-angle-up","uk-icon-arrow-circle-down","uk-icon-arrow-circle-left","uk-icon-arrow-circle-o-down","uk-icon-arrow-circle-o-left","uk-icon-arrow-circle-o-right","uk-icon-arrow-circle-o-up","uk-icon-arrow-circle-right","uk-icon-arrow-circle-up","uk-icon-arrow-down","uk-icon-arrow-left","uk-icon-arrow-right","uk-icon-arrow-up","uk-icon-arrows","uk-icon-arrows-alt","uk-icon-arrows-h","uk-icon-arrows-v","uk-icon-caret-down","uk-icon-caret-left","uk-icon-caret-right","uk-icon-caret-square-o-down","uk-icon-caret-square-o-left","uk-icon-caret-square-o-right","uk-icon-caret-square-o-up","uk-icon-caret-up","uk-icon-chevron-circle-down","uk-icon-chevron-circle-left","uk-icon-chevron-circle-right","uk-icon-chevron-circle-up","uk-icon-chevron-down","uk-icon-chevron-left","uk-icon-chevron-right","uk-icon-chevron-up","uk-icon-hand-o-down","uk-icon-hand-o-left","uk-icon-hand-o-right","uk-icon-hand-o-up","uk-icon-long-arrow-down","uk-icon-long-arrow-left","uk-icon-long-arrow-right","uk-icon-long-arrow-up","uk-icon-toggle-down","uk-icon-toggle-left","uk-icon-toggle-right","uk-icon-toggle-up"],"Video Player Icons":["uk-icon-arrows-alt","uk-icon-backward","uk-icon-compress","uk-icon-eject","uk-icon-expand","uk-icon-fast-backward","uk-icon-fast-forward","uk-icon-forward","uk-icon-pause","uk-icon-play","uk-icon-play-circle","uk-icon-play-circle-o","uk-icon-step-backward","uk-icon-step-forward","uk-icon-stop","uk-icon-youtube-play"],"Brand Icons":["uk-icon-adn","uk-icon-android","uk-icon-apple","uk-icon-bitbucket","uk-icon-bitbucket-square","uk-icon-bitcoin","uk-icon-btc","uk-icon-css3","uk-icon-dribbble","uk-icon-dropbox","uk-icon-facebook","uk-icon-facebook-square","uk-icon-flickr","uk-icon-foursquare","uk-icon-github","uk-icon-github-alt","uk-icon-github-square","uk-icon-gittip","uk-icon-google-plus","uk-icon-google-plus-square","uk-icon-html5","uk-icon-instagram","uk-icon-linkedin","uk-icon-linkedin-square","uk-icon-linux","uk-icon-maxcdn","uk-icon-pagelines","uk-icon-pinterest","uk-icon-pinterest-square","uk-icon-renren","uk-icon-skype","uk-icon-stack-exchange","uk-icon-stack-overflow","uk-icon-trello","uk-icon-tumblr","uk-icon-tumblr-square","uk-icon-twitter","uk-icon-twitter-square","uk-icon-vimeo-square","uk-icon-vk","uk-icon-weibo","uk-icon-windows","uk-icon-xing","uk-icon-xing-square","uk-icon-youtube","uk-icon-youtube-play","uk-icon-youtube-square"],"Medical Icons":["uk-icon-ambulance","uk-icon-h-square","uk-icon-hospital-o","uk-icon-medkit","uk-icon-plus-square","uk-icon-stethoscope","uk-icon-user-md","uk-icon-wheelchair"]};list.push('<ul class="uk-list uk-list-space">');$.each(icons,function(group,icos){list.push("<li><strong>"+group+"</strong></li>");$.each(icos,function(){list.push('<li><a href="" class="'+this+' uk-icon-small" data-warp-icon="'+this+'"> '+this+"</a></li>")})});list.push("</ul>");picker.append(list.join("\n"));$(".tm-main").on("focus","input[name$='[icon]']",function(e){e.preventDefault();var input=$(this),offset=input.offset(),top=offset.top+input.height()+15;left=offset.left;picker.data("input",input).css({top:top,left:left}).show();picker[0].scrollTop=0});picker.on("click","[class*='uk-icon']",function(e){e.preventDefault();picker.data("input").val($(this).data("warpIcon"));picker.hide()});$(document).on("click",function(e){if(picker.is(":visible")&&!$(e.target).is("input[name$='[icon]']"))picker.hide()})}function layouts(root,source){var $this=$(root),$select=$("[data-layout-selector]",$this),field=$this.data("field-name"),$buttons=$("[data-action=rename], [data-action=remove]",$this),$assignments=$("[data-assignment]",$this);$assignments.filter('[data-layout="default"] [data-assignment]').hide();$("input:checked",$assignments).each(function(){assign($(this))});$select.on("change",function(e){show($select.val())}).trigger("change");$this.on("change","[data-assignment] input",function(e){assign($(e.target))}).on("click",'[data-action="add"]',function(e){e.preventDefault();add(prompt("Please enter a layout name",""))}).on("click",'[data-action="rename"]',function(e){e.preventDefault();var from=$select.val();var to=prompt("Please enter a layout name",from);rename(from,to)}).on("click",'[data-action="remove"]',function(e){e.preventDefault();remove($select.val())});$("[data-layout]",$this).each(function(){$('select[name$="[width]"]:first',this).on("change",function(){var $this=$(this),gcf=$this.find('option[value="'+$this.val()+'"]').data("gcf");$this.closest("[data-layout]").find('select[name$="[width]"]:gt(0)').each(function(){var select=$(this),value=select.val();select.empty().append($this.find("option").clone().filter(function(){return $(this).val()%gcf===0})).val(select.find('option[value="'+value+'"]').length?value:select.val())})}).trigger("change")});function assign(item){$('[value="'+item.prop("value")+'"]',$assignments).not(item).attr("disabled",item.is(":checked")?"disabled":false)}function show(name){$buttons.toggle(name!=="default");$("[data-layout]").not($('[data-layout="'+name+'"]').show()).hide()}function add(name){if(name&&!$('option[value="'+name+'"]',$select).length){var layout=$(source).clone(true);_rename(layout,name);$(source).parent().children("[data-layout]:last").after(layout);$select.append('<option value="'+name+'">'+name+"</option>").val(name).trigger("change");$("[data-assignment]",layout).show()}}function rename(from,to){if(to&&from!==to&&!$('option[value="'+to+'"]',$select).length){_rename($('[data-layout="'+from+'"]'),to);$select.find('option[value="'+from+'"]').attr("value",to).html(to)}}function _rename(layout,to){var from=layout.data("layout");layout.attr("data-layout",to).find('[name^="'+field+"["+from+']"]').attr("name",function(i,value){return value.replace(field+"["+from+"]",field+"["+to+"]")})}function remove(name){$('[data-layout="'+name+'"]').remove();$select.find('option[value="'+name+'"]').remove().end().trigger("change")}}function deviceControls(cls){$(cls).on("click","li",function(e){e.preventDefault();$(this).toggleClass("active").find("input").val($(this).hasClass("active")?"1":"0")}).find("li").each(function(){$(this).toggleClass("active",$(this).find("input").val()!=="0")})}function menus(root){$("tr[data-level='1'] + tr[data-level='2']",root).each(function(){$(this).prev().find("td:first").prepend('<i class="uk-icon-angle-right"></i> ').wrapInner("<span data-toggler />")});$("tbody tr[data-level!='1']",root).hide();$(root).on("click","[data-toggler]",function(){$(this).closest("tr").nextUntil("tr[data-level='1']",root).toggle();$("i",this).toggleClass("uk-icon-angle-down")});$("[data-menu-filter]",root).on("change",function(){$("[data-menu]").not($('[data-menu="'+$(this).val()+'"]').show()).hide()}).trigger("change")}function isLessCompilingEnabled(){if(!window.btoa){return false}try{return!!new Blob&&typeof FormData!==undefined}catch(e){return false}}})(jQuery,window["sessionStorage"]||{});(function($){var Customizer=function($element,$options){var $select=$($options.select,$element),$sidebar=$($options.sidebar,$element),$advanced=$($options.advanced,$element),$error=$($options.error,$element),$style;$element.on({update:function(e,value,force){if($("option",$select).length!=$options.styles.length){$select.html($.mustache($options.template.select,$options))}if(value){$select.val(value)}var name=$select.val(),current=$style;$.each($options.styles,function(i,style){if(name==style.name){$style=style}});if($style!==current||force){$element.trigger("updating",$style);loadStyle($style).done(function(){renderSidebar($style);$element.trigger("updated",$style)}).fail(function(e){$error.html($.mustache('<h1 class="uk-h3">Error</h1><p>{{message}}</p>',{message:e})).show()})}},updating:$options.updating,updated:$options.updated});$select.on("change",function(e){setTimeout(function(){$element.trigger("update")},1)});$advanced.on("change",function(e){$sidebar[$(this).prop("checked")?"addClass":"removeClass"]("cm-show-advanced")}).trigger("change");$element.on("click","a.cm-more-link",function(e){e.preventDefault();$(this).parents("fieldset:first").toggleClass("cm-show-more")});$element.on("change","input[name=vars], select[name=vars]",function(e){e.preventDefault();var name=$(this).attr("data-name"),value=$(this).val();if(value===""){delete $style.variables[name]}else{$style.variables[name]=value}$element.trigger("updated",$style)});function loadStyle(style){var deferred=$.Deferred();if(style.groups){return deferred.resolve()}$.ajax({url:style.config,cache:false,dataType:"json"}).done(function(config){var vars=$.extend({},style.config_vars);style.config=config;style.groups=[];style.variables=style.variables||{};style.matchName=matchName;$.each(style.config.groups,function(i,grp){var variable,group={label:grp.label,variables:[],advanced:grp.advanced||false,more:false};$.each(grp.vars,function(i,opt){$.each(vars,function(name,value){if(matchName(opt,name)){delete vars[name];variable={name:name,"default":value,placeholder:value,label:name.replace(/^@/,"").replace(/^\w+\-/,"").replace(/\-/g," "),more:value.indexOf("@")!==-1,value:function(){return style.variables[name]?style.variables[name]:""}};if(variable.more){group.more=true;variable.placeholder="@"}group.variables.push(variable)}})});if(group.variables.length){style.groups.push(group)}});deferred.resolve()}).fail(function(jqXHR,textStatus,errorThrown){deferred.reject("Unable to retrieve "+style.config+" ("+errorThrown+")")});return deferred.promise()}function renderSidebar(style){$sidebar.html($.mustache($options.template.sidebar,style));$sidebar.find("input[data-name]").each(function(){var input=$(this),value=input.val()||input.data("default"),select,groups;if(input.attr("data-default").indexOf("@")!==-1){return}$.each(style.config.controls,function(i,control){$.each(control.vars,function(i,pattern){if(matchName(pattern,input.attr("data-name"))){switch(control.type){case"color":var placeholder=$('<div class="sp-placeholder"><div class="sp-placeholder-color"></div></div>').find("div").css("background-color",value).end().on("click",function(){var spectrum;input.spectrum({showInput:true,showAlpha:true,color:value,change:function(color){if(color.toRgb().a<1){input.val(color.toRgbString()).trigger("change")}},show:function(){if(!spectrum){spectrum=$.fn.spectrum.get(input.data("spectrum.id"));spectrum.container.find(".sp-cancel").after($('<a href="#" class="sp-reset">reset</a>').on("click",function(e){e.preventDefault();spectrum.set(input.data("default"));spectrum.hide();input.val("")}))}}}).on("show-spectrum",function(){if(parseInt(spectrum.container.find(".sp-slider").css("top"))>spectrum.container.find(".sp-hue").height()){spectrum.container.find(".sp-slider").css("top",0)}});placeholder.remove();setTimeout(function(){input.spectrum("show")},50)});input.hide().after(placeholder);break;case"font":groups=[];if($.isArray(control.options)){groups.push({group:"",options:control.options})}else{$.each(control.options,function(group,options){groups.push({group:group,options:options})})}select=$($.mustache('<select>{{#groups}}{{#group}}<optgroup label="{{group}}">{{/group}}{{#options}}<option value="{{value}}"{{#url}} data-url="{{url}}"{{/url}}>{{name}}</option>{{/options}}{{#group}}</optgroup>{{/group}}{{/groups}}</select>',{groups:groups}));input.replaceWith(select.val(value).attr("class",input.attr("class")).attr("name",input.attr("name")).attr("data-name",input.attr("data-name")));break;case"select":select=$($.mustache('<select>{{#options}}<option value="{{value}}">{{name}}</option>{{/options}}</select>',{options:control.options}));input.replaceWith(select.val(value).attr("class",input.attr("class")).attr("name",input.attr("name")).attr("data-name",input.attr("data-name")));break}}})})})}function matchName(pattern,path){var parsedPattern="^"+pattern.replace(/\//g,"\\/").replace(/\*\*/g,"(\\/[^\\/]+)*").replace(/\*/g,"[^\\/]+").replace(/((?!\\))\?/g,"$1.")+"$";parsedPattern="^"+parsedPattern+"$";return path.match(new RegExp(parsedPattern))!==null}};$.fn.customizer=function(options){return this.each(function(){var defaults={updating:$.noop(),updated:$.noop(),select:"select[name=style]",advanced:"input[name=advanced]",sidebar:"section.cm-sidebar-content",error:".cm-error",template:{select:'{{#styles}}<option value="{{name}}">{{name}}</option>{{/styles}}',sidebar:'<div class="cm-vars cm-form uk-form">                             {{#groups}}                             <fieldset{{#advanced}} class="cm-advanced"{{/advanced}}>                                 <h2 class="cm-form-title">{{label}}{{#more}} <a href="#" class="cm-more-link"></a>{{/more}}</h2>                                 {{#variables}}                                 <div class="uk-form-row{{#more}} cm-more{{/more}}">                                     <label class="uk-form-label" title="{{name}}">{{label}}</label>                                     <div class="uk-form-controls">                                         <input class="uk-form-small" name="vars" type="text"{{#value}} value="{{value}}"{{/value}} placeholder="{{placeholder}}" data-name="{{name}}" data-default="{{default}}">                                     </div>                                 </div>                                 {{/variables}}                             </fieldset>                             {{/groups}}                         </div>'}};new Customizer($(this),$.extend({},defaults,options))})}})(jQuery);if(typeof window.parse_str!="function"){function parse_str(str,array){var strArr=String(str).replace(/^&/,"").replace(/&$/,"").split("&"),sal=strArr.length,i,j,ct,p,lastObj,obj,lastIter,undef,chr,tmp,key,value,postLeftBracketPos,keys,keysLen,fixStr=function(str){return decodeURIComponent(str.replace(/\+/g,"%20"))};if(!array){array=this.window}for(i=0;i<sal;i++){tmp=strArr[i].split("=");key=fixStr(tmp[0]);value=tmp.length<2?"":fixStr(tmp[1]);while(key.charAt(0)===" "){key=key.slice(1)}if(key.indexOf("\x00")>-1){key=key.slice(0,key.indexOf("\x00"))}if(key&&key.charAt(0)!=="["){keys=[];postLeftBracketPos=0;for(j=0;j<key.length;j++){if(key.charAt(j)==="["&&!postLeftBracketPos){postLeftBracketPos=j+1}else if(key.charAt(j)==="]"){if(postLeftBracketPos){if(!keys.length){keys.push(key.slice(0,postLeftBracketPos-1))}keys.push(key.substr(postLeftBracketPos,j-postLeftBracketPos));postLeftBracketPos=0;if(key.charAt(j+1)!=="["){break}}}}if(!keys.length){keys=[key]}for(j=0;j<keys[0].length;j++){chr=keys[0].charAt(j);if(chr===" "||chr==="."||chr==="["){keys[0]=keys[0].substr(0,j)+"_"+keys[0].substr(j+1)}if(chr==="["){break}}obj=array;for(j=0,keysLen=keys.length;j<keysLen;j++){key=keys[j].replace(/^['"]/,"").replace(/['"]$/,"");lastIter=j!==keys.length-1;lastObj=obj;if(key!==""&&key!==" "||j===0){if(obj[key]===undef){obj[key]={}}obj=obj[key]}else{ct=-1;for(p in obj){if(obj.hasOwnProperty(p)){if(+p>ct&&p.match(/^\d+$/g)){ct=+p}}}key=ct+1}}lastObj[key]=value}}}}