(function(e,t,n,r){function o(t,n){this.element=t,this.options=e.extend({},s,n),this._defaults=s,this.theForm=e(this.options.formSelector),this.filterButton=e(this.options.formSelector+" "+this.options.filterBtnSelector),this.filterContainer=e(this.options.formSelector+" "+this.options.filterContainerSelector),this.filtersHidden=this.options.filtersHidden,this.listButton=e(this.options.formSelector+" "+this.options.listBtnSelector),this.listContainer=e(this.options.formSelector+" "+this.options.listContainerSelector),this.listHidden=this.options.listHidden,this.mainContainer=e(this.options.mainContainerSelector),this.searchButton=e(this.options.formSelector+" "+this.options.searchBtnSelector),this.searchField=e(this.options.formSelector+" "+this.options.searchFieldSelector),this.searchString=null,this.clearButton=e(this.options.clearBtnSelector),this.orderCols=e(this.options.formSelector+" "+this.options.orderColumnSelector),this.orderField=e(this.options.formSelector+" "+this.options.orderFieldSelector),this.limitField=e(this.options.formSelector+" "+this.options.limitFieldSelector),this.activeColumn=null,this.activeDirection=this.options.activeDirection,this.activeOrder=this.options.activeOrder,this.activeLimit=null,this.chosenSupport=this.options.chosenSupport,this.clearListOptions=this.options.clearListOptions,this._name=i,this.init()}var i="searchtools",s={formSelector:".js-stools-form",searchFieldSelector:".js-stools-field-search",clearBtnSelector:".js-stools-btn-clear",mainContainerSelector:".js-stools",searchBtnSelector:".js-stools-btn-search",filterBtnSelector:".js-stools-btn-filter",filterContainerSelector:".js-stools-container-filters",filtersHidden:!0,listBtnSelector:".js-stools-btn-list",listContainerSelector:".js-stools-container-list",listHidden:!1,orderColumnSelector:".js-stools-column-order",orderBtnSelector:".js-stools-btn-order",orderFieldSelector:".js-stools-field-order",orderFieldName:"list[fullordering]",limitFieldSelector:".js-stools-field-limit",defaultLimit:20,activeOrder:null,activeDirection:"ASC",chosenSupport:!0,clearListOptions:!1};o.prototype={init:function(){var t=this;this.searchString=this.searchField.val(),this.filtersHidden?this.hideFilters():this.showFilters(),this.listHidden?this.hideList():this.showList(),t.filterButton.click(function(e){t.toggleFilters(),e.stopPropagation(),e.preventDefault()}),t.listButton.click(function(e){t.toggleList(),e.stopPropagation(),e.preventDefault()}),t.getFilterFields().each(function(n,r){t.checkFilter(r),e(r).change(function(){t.checkFilter(r)})}),t.clearButton.click(function(e){t.clear()}),this.createOrderField(),this.orderCols.click(function(){var n=e(this).attr("data-order"),r="ASC",i=n+" "+r;n.length&&(t.activeColumn=n,i!==t.activeOrder?(t.activeDirection=r,t.activeOrder=i,t.updateFieldValue(t.orderField,i)):t.toggleDirection(),t.theForm.submit())})},checkFilter:function(t){var n=this,r=e(t).find("option:selected");r.val()!=""?n.activeFilter(t):n.deactiveFilter(t)},clear:function(){var t=this;t.getFilterFields().each(function(n,r){e(r).val(""),t.checkFilter(r),t.chosenSupport&&e(r).trigger("liszt:updated")}),t.clearListOptions&&(t.getListFields().each(function(n,r){e(r).val(""),t.checkFilter(r),t.chosenSupport&&e(r).trigger("liszt:updated")}),e("#list_limit").val(t.options.defaultLimit),t.chosenSupport&&e("#list_limit").trigger("liszt:updated")),t.searchField.val(""),t.theForm.submit()},activeFilter:function(t){var n=this;e(t).addClass("active");var r="#"+e(t).attr("id")+"_chzn";e(r).addClass("active")},deactiveFilter:function(t){var n=this;e(t).removeClass("active");var r="#"+e(t).attr("id")+"_chzn";e(r).removeClass("active")},getFilterFields:function(){return this.filterContainer.find("select")},getListFields:function(){return this.listContainer.find("select")},hideContainer:function(t){e(t).hide("fast"),e(t).removeClass("shown")},showContainer:function(t){e(t).show("fast"),e(t).addClass("shown")},toggleContainer:function(t){e(t).hasClass("shown")?this.hideContainer(t):this.showContainer(t)},hideList:function(){this.hideContainer(this.listContainer),this.listButton.removeClass("btn-primary")},showList:function(){this.showContainer(this.listContainer),this.listButton.addClass("btn-primary")},toggleList:function(){this.toggleContainer(this.listContainer),this.listContainer.hasClass("shown")?this.listButton.addClass("btn-primary"):this.listButton.removeClass("btn-primary")},hideFilters:function(){this.hideContainer(this.filterContainer),this.filterButton.removeClass("btn-primary")},showFilters:function(){this.showContainer(this.filterContainer),this.filterButton.addClass("btn-primary")},toggleFilters:function(){this.toggleContainer(this.filterContainer),this.filterContainer.hasClass("shown")?this.filterButton.addClass("btn-primary"):this.filterButton.removeClass("btn-primary")},toggleDirection:function(){var e=this,t="ASC";e.activeDirection.toUpperCase()=="ASC"&&(t="DESC"),e.activeDirection=t,e.activeOrder=e.activeColumn+" "+t,e.updateFieldValue(e.orderField,e.activeOrder)},createOrderField:function(){var t=this;this.orderField.length||(this.orderField=e("<input>").attr({type:"hidden",id:"js-stools-field-order","class":"js-stools-field-order",name:t.options.orderFieldName,value:t.activeOrder+" "+this.activeDirection}),this.orderField.appendTo(this.theForm)),this.orderField.is("select")&&(this.orderCols.each(function(){var n=e(this).attr("data-order"),r=e(this).attr("data-name"),i=e(this).attr("data-direction");if(n.length){n=n+" "+i;var s=t.findOption(t.orderField,n);if(!s.length){var s=e("<option>");s.text(r).val(n),e(this).hasClass("active")&&s.attr("selected","selected"),t.orderField.append(s)}}}),this.orderField.trigger("liszt:updated")),this.activeOrder=this.orderField.val()},updateFieldValue:function(t,n){var r=this,i=t.attr("type");if(i==="hidden"||i==="text")t.attr("value",n);else if(t.is("select")){var s=t.find("option").filter(function(){return e(this).val()==n});if(s.length)s.attr("selected","selected");else{var o=e("<option>");o.text(n).val(n),o.attr("selected","selected"),t.append(o)}r.chosenSupport&&t.trigger("liszt:updated")}},findOption:function(t,n){return t.find("option").filter(function(){return e(this).val()==n})}},e.fn[i]=function(t){return this.each(function(){e.data(this,"plugin_"+i)||e.data(this,"plugin_"+i,new o(this,t))})}})(jQuery,window,document);